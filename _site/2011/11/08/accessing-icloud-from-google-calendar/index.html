<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Accessing iCloud from Google Calendar &middot; nxhelp.com
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Serif:400,400italic,700|Droid+Sans:400">
  <link rel="stylesheet" href="http://weloveiconfonts.com/api/?family=entypo">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-146052-15', 'getpoole.com');
    ga('send', 'pageview');
  </script>
</head>


  <body class="theme-base-0d">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" checked>

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/projects/">Projects</a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://github.com/acidix/nxhelp">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h3 class="masthead-title">
            <a href="/" title="Home">nxhelp.com</a>
            <small>by Thomas Uhde</small>
          </h3>
        </div>
      </div>

      <div class="container content" id="container">
        <div class="post">
  <h1 class="post-title post-title-blog"> <a href="">Accessing iCloud from Google Calendar</a></h1>
    
    <span class="post-date">November 8th 2011</span>
    
   <span class="social">[ <a target="_blank" rel="nofollow" href="https://twitter.com/intent/tweet?original_referer=%2F2011%2F11%2F08%2Faccessing-icloud-from-google-calendar%2F&text=Accessing+iCloud+from+Google+Calendar&url=http%3A%2F%2Fnxhelp.com%2F%2F2011%2F11%2F08%2Faccessing-icloud-from-google-calendar%2F&via=ThomasUhde" title="Tweet this post">tweet</a> : <a target="_blank" rel="nofollow" href="https://alpha.app.net/intent/post?text=Accessing%20iCloud%20from%20Google%20Calendar%20%2D%20http%3A%2F%2Fnxhelp.com%2F%2F2011%2F11%2F08%2Faccessing-icloud-from-google-calendar%2F">adn</a>]</span>
  <p>Accessing my iCloud Calendar from within Google Calendar was a major issue since my move to iCloud. Having said that, it&#39;s not even my own &quot;Backup&quot; setup on Google Apps that bothers me that    much, it&#39;s more about sharing my calendar with other family members that are not using iCloud.</p>

<h3>Getting Access - the easy part</h3>

<p>Getting access itself is, despite one small caveat, the easy task. You&#39;ll have to publicly share your calendar. WIthout public sharing only iCloud users will be able to access your calendar. Despite the fact that you&#39;ll share your calendar with the world - that&#39;s a minor pitfall to take.</p>

<h3>Getting Access - the problem ...</h3>

<p>However, if you now try to access your calendar from Google (replacing <code>webcal://</code> by <code>http://</code>), you&#39;ll be presented with the following error:</p>

<p><img style="display: block; margin-left: auto; margin-right: auto;" title="Screen Shot 2011-11-08 at 21.06.19.png" src="http://www.nxhelp.com/wp-content/uploads/2011/11/Screen-Shot-2011-11-08-at-21.06.19.png" border="0" alt="Screen    Shot 2011 11 08 at 21 06 19" width="459" height="111" /></p>

<p>The iCloud servers seem to prevent access from Google - probably mainly to avoid the Google servers crawling all public calendars, but with the drawback of keeping us from accessing our calendar. After a [post in the iCloud]{https://discussions.apple.com/message/16617386#16617386} forums I don&#39;t have much confidence this will be fixed soon … </p>

<h3>Solution 1 - the PHP script</h3>

<p>So, I thought there must be an easier way than relying on Apple to fix the problem. Actually, there were 2 solutions that came to my mind:</p>

<ul>
<li>Apache Reverse Proxy</li>
<li>A PHP script</li>
</ul>

<p>Saying that I know that the majority of people doesn&#39;t have an own (V-)Server to run an Apache instance they can actually configure. However, there are plenty of (free) providers that allow you to run PHP scripts.
The following script gets the calendar (via the public URL) from iCloud and presents it in a way that Google Calendar will be able to access it:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="c1">// Set error level reporting level</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ERROR</span><span class="p">);</span>

<span class="c1">// create a new curl resource and set options</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>

<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;https://&lt;your iCloud feed&gt;&quot;</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_BINARYTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// grab URL, and return output</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>

<span class="c1">// Send the header based on the response from the server</span>
<span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-type: text/calendar&#39;</span><span class="p">);</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Cache-Control: no-cache, must-revalidate&quot;</span><span class="p">);</span> 

<span class="c1">// HTTP/1.1</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Expires: Sat, 26 Jul 1997 05:00:00 GMT&quot;</span><span class="p">);</span> 
<span class="c1">// Date in the past</span>

<span class="c1">// Send the curl output</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$output</span><span class="p">))</span><span class="err"> </span> <span class="err"> </span> 
    <span class="k">echo</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
    <span class="k">else</span>
    <span class="err"> </span> <span class="err"> </span> <span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
    
    <span class="c1">// close curl resource</span>
    <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
    
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>

<h3>Solution 2 - mod_proxy</h3>

<p>The even easier solution (as long as you&#39;ve got your own configurable Apache instance) is using mod<em>proxy to use a simple HTTP Reverse Proxy to get the feed from the Apple Servers and redirect it. One pitfall though is that the iCloud access strictly requires https access, so we&#39;ll have to configure apache for ssl as well. This example is based on a RedHat 5.4 system, so adapt accordingly ...
     
First, install apache2 and mod</em>ssl</p>

<div class="highlight"><pre><code class="bash">yum install httpd mod_ssl
</code></pre></div>

<p>Next, we&#39;ll configure the SSL Engine:</p>

<div class="highlight"><pre><code class="bash">vi /etc/httpd/conf.d/ssl.conf

...
&lt;VirtualHost _default_:1443&gt;
SSLProxyEngine on
SSLOptions -StrictRequire
...
</code></pre></div>

<p>Having configured https and enabling the SSL Proxy option, we can now go ahead an get the actual ReverseProxy working:</p>

<div class="highlight"><pre><code class="bash">vi /etc/httpd/conf/httpd.conf
</code></pre></div>

<p>Add the following lines to the end of the file:</p>

<div class="highlight"><pre><code class="bash">ProxyRequests   off
SSLProxyEngine  on
    
&lt;Proxy *&gt;
   Order deny,allow
   Allow from all
&lt;/Proxy&gt;
    
<span class="c"># Set TCP/IP network buffer size for better throughput (bytes)</span>
ProxyReceiveBufferSize 4096
    
ProxyPass /ical/ https://p03-calendarws.icloud.com/
ProxyPassReverse /ical/ https://p03-calendarws.icloud.com/
</code></pre></div>

<p>Now, start the apache process:</p>

<div class="highlight"><pre><code class="bash">/etc/init.d/httpd start
</code></pre></div>

<p>You can now access your calendar by replacing the <code>webcal://p03-calendarws.icloud.com/</code> part of your public URL by <code>http(s)://yourserver/ical/</code>, making is something like <code>http://yourserver/ical/ca/subscribe/1/pY7JHjsAi</code> ...</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
    
  <div class="archive">
  
  <h3 class="post-title post-title-ext">
    <time>09 Dec</time>
    <a href="http://professionalvmware.com/2008/12/share-and-share-alike-sharing-vmdks-between-virtual-machines/">
  
Sharing a virtual disk between virtual machines in VMWare vSphere 5.5
      </a>
    </h3>
  </div>
    
  <div class="archive">
  
  <h3 class="post-title post-title-ext">
    <time>26 Sep</time>
    <a href="http://ariekanarie.nl/archives/211/remote-kernel-upgrade-with-debianubuntu-and-grub2">
  
Remote Kernel upgrade with Debian/Ubuntu and Grub2
      </a>
    </h3>
  </div>
    
  <div class="archive">
  
  <h3 class="post-title post-title-ext">
    <time>09 Sep</time>
    <a href="http://raxcloud.blogspot.de/2013/02/documenting-python-code-using-sphinx.html">
  
Documenting Python code using Sphinx and GitHub
      </a>
    </h3>
  </div>
    
</div>

      </div>
    </div>

  </body>
</html>
